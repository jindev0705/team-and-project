<%= stylesheet_link_tag    'plugins/datatables.bundle', media: 'all', 'data-turbolinks-track' => true %>
<%= javascript_include_tag 'plugins/datatables.bundle', 'data-turbolinks-track' => true %>
<style>
  div#kt_member_table_filter label, div#kt_team_table_filter label, div#kt_project_table_filter label {
      display: none;
  }
</style>
<div class="post d-flex flex-column-fluid" id="kt_post">
  <!--begin::Container-->
  <div id="kt_content_container" class="container-fluid">
    <div class="row">
      <div class="col-lg-12">
        <div class="card mb-7">
          <div class="card-header">
            <div class="card-title">
              <h2>Members</h2>
            </div>
            <div class="card-toolbar">
              <div class="d-flex align-items-center position-relative my-1 me-5">
                <!--begin::Svg Icon | path: icons/duotune/general/gen021.svg-->
                <span class="svg-icon svg-icon-1 position-absolute ms-6">
											<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
												<rect opacity="0.5" x="17.0365" y="15.1223" width="8.15546" height="2" rx="1" transform="rotate(45 17.0365 15.1223)" fill="black"></rect>
												<path d="M11 19C6.55556 19 3 15.4444 3 11C3 6.55556 6.55556 3 11 3C15.4444 3 19 6.55556 19 11C19 15.4444 15.4444 19 11 19ZM11 5C7.53333 5 5 7.53333 5 11C5 14.4667 7.53333 17 11 17C14.4667 17 17 14.4667 17 11C17 7.53333 14.4667 5 11 5Z"
                              fill="black"></path>
											</svg>
										</span>
                <!--end::Svg Icon-->
                <input type="text" aria-controls="kt_member_table" data-kt-member-table-filter="search" class="form-control form-control-solid w-250px ps-15" placeholder="Search" />
              </div>

              <div class="d-flex justify-content-end" data-kt-user-table-toolblar="base">
                <a href="<%= new_member_path %>" class="btn btn-primary">Add Member</a>
              </div>
            </div>
          </div>
          <div class="card-body">
            <!--begin::Datatable-->
            <table id="kt_member_table" class="table align-middle table-row-dashed fs-6 gy-5">
              <thead>
              <tr class="text-start text-gray-400 fw-bolder fs-7 text-uppercase gs-0">
                <th>No</th>
                <th>First Name</th>
                <th>Last Name</th>
                <th>City</th>
                <th>State</th>
                <th>Country</th>
                <th>Team</th>
                <th class="text-end min-w-100px">Actions</th>
              </tr>
              </thead>
              <tbody class="text-gray-600 fw-bold">
              <% @members.each_with_index do |member, index| %>
                <tr>
                  <td><%= index + 1 %></td>
                  <td><%= member['first_name'] %></td>
                  <td><%= member['last_name'] %></td>
                  <td><%= member['city'] %></td>
                  <td><%= member['state'] %></td>
                  <td><%= member['country'] %></td>
                  <td><%= member['team_name'] %></td>
                  <td class="text-end">
                    <div class="d-inline-block">
                      <a href="<%= edit_member_path(member['id']) %>" class="menu-link px-3" >Edit </a>
                      <a href="javascript:void(0);" class="delete_member menu-link px-3" data-member-id="<%= member['id'] %>">Delete</a>

                    </div>
                  </td>
                </tr>
              <% end %>
              </tbody>
            </table>
            <!--end::Datatable-->
          </div>
        </div>
      </div>

      <div class="col-lg-6">
        <div class="card mb-7">
          <div class="card-header">
            <div class="card-title">
              <h2>Teams</h2>
            </div>
            <div class="card-toolbar">
              <div class="d-flex align-items-center position-relative my-1 me-5">
                <!--begin::Svg Icon | path: icons/duotune/general/gen021.svg-->
                <span class="svg-icon svg-icon-1 position-absolute ms-6">
											<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
												<rect opacity="0.5" x="17.0365" y="15.1223" width="8.15546" height="2" rx="1" transform="rotate(45 17.0365 15.1223)" fill="black"></rect>
												<path d="M11 19C6.55556 19 3 15.4444 3 11C3 6.55556 6.55556 3 11 3C15.4444 3 19 6.55556 19 11C19 15.4444 15.4444 19 11 19ZM11 5C7.53333 5 5 7.53333 5 11C5 14.4667 7.53333 17 11 17C14.4667 17 17 14.4667 17 11C17 7.53333 14.4667 5 11 5Z"
                              fill="black"></path>
											</svg>
										</span>
                <!--end::Svg Icon-->
                <input type="text" aria-controls="kt_team_table" data-kt-team-table-filter="search" class="form-control form-control-solid w-150px ps-15" placeholder="Search" />
              </div>

              <div class="d-flex justify-content-end" data-kt-user-table-toolblar="base">
                <a href="<%= new_team_path %>" class="btn btn-primary">Add Team</a>
              </div>
            </div>
          </div>
          <div class="card-body">
            <!--begin::Datatable-->
            <table id="kt_team_table" class="table align-middle table-row-dashed fs-6 gy-5">
              <thead>
              <tr class="text-start text-gray-400 fw-bolder fs-7 text-uppercase gs-0">
                <th>No</th>
                <th>Name</th>
                <th class="text-end min-w-100px">Actions</th>
              </tr>
              </thead>
              <tbody class="text-gray-600 fw-bold">
              <% @teams.each_with_index do |team, index| %>
                <tr>
                  <td><%= index + 1 %></td>
                  <td><%= team['name'] %></td>
                  <td class="text-end">
                    <div class="d-inline-block">
                      <a href="<%= team_view_members_path(team['id']) %>" class="menu-link px-3" >View members </a>
                      <a href="<%= edit_team_path(team['id']) %>" class="menu-link px-3" >Edit </a>
                      <a href="javascript:void(0);" class="delete_team menu-link px-3" data-team-id="<%= team['id'] %>">Delete</a>
                    </div>
                  </td>
                </tr>
              <% end %>
              </tbody>
            </table>
            <!--end::Datatable-->
          </div>
        </div>
      </div>

      <div class="col-lg-6">
        <div class="card mb-7">
          <div class="card-header">
            <div class="card-title">
              <h2>Projects</h2>
            </div>
            <div class="card-toolbar">
              <div class="d-flex align-items-center position-relative my-1 me-5">
                <!--begin::Svg Icon | path: icons/duotune/general/gen021.svg-->
                <span class="svg-icon svg-icon-1 position-absolute ms-6">
											<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
												<rect opacity="0.5" x="17.0365" y="15.1223" width="8.15546" height="2" rx="1" transform="rotate(45 17.0365 15.1223)" fill="black"></rect>
												<path d="M11 19C6.55556 19 3 15.4444 3 11C3 6.55556 6.55556 3 11 3C15.4444 3 19 6.55556 19 11C19 15.4444 15.4444 19 11 19ZM11 5C7.53333 5 5 7.53333 5 11C5 14.4667 7.53333 17 11 17C14.4667 17 17 14.4667 17 11C17 7.53333 14.4667 5 11 5Z"
                              fill="black"></path>
											</svg>
										</span>
                <!--end::Svg Icon-->
                <input type="text" aria-controls="kt_project_table" data-kt-project-table-filter="search" class="form-control form-control-solid w-150px ps-15" placeholder="Search" />
              </div>

              <div class="d-flex justify-content-end" data-kt-user-table-toolblar="base">
                <a href="<%= new_project_path %>" class="btn btn-primary">Add Project</a>
              </div>
            </div>
          </div>
          <div class="card-body">
            <!--begin::Datatable-->
            <table id="kt_project_table" class="table align-middle table-row-dashed fs-6 gy-5">
              <thead>
              <tr class="text-start text-gray-400 fw-bolder fs-7 text-uppercase gs-0">
                <th>No</th>
                <th>Name</th>
                <th class="text-end min-w-100px">Actions</th>
              </tr>
              </thead>
              <tbody class="text-gray-600 fw-bold">
              <% @projects.each_with_index do |project, index| %>
                <tr>
                  <td><%= index + 1 %></td>
                  <td><%= project['name'] %></td>
                  <td class="text-end">
                    <div class="d-inline-block">
                      <a href="<%= project_view_members_path(project['id']) %>" class="menu-link px-3" >View members </a>
                      <a href="<%= project_new_members_path(project['id']) %>" class="menu-link px-3" >Add members </a>
                      <a href="<%= edit_project_path(project['id']) %>" class="menu-link px-3" >Edit </a>
                      <a href="javascript:void(0);" class="delete_project menu-link px-3" data-project-id="<%= project['id'] %>">Delete</a>
                    </div>
                  </td>
                </tr>
              <% end %>
              </tbody>
            </table>
            <!--end::Datatable-->
          </div>
        </div>
      </div>
    </div>

  </div>
  <!--end::Container-->
</div>

<script>
    const member_table = $('table#kt_member_table').DataTable();
    $('input[data-kt-member-table-filter=search]').on('keyup', function(e) {
        member_table.search(e.target.value).draw();
    })

    const team_table = $('table#kt_team_table').DataTable();
    $('input[data-kt-team-table-filter=search]').on('keyup', function(e) {
        team_table.search(e.target.value).draw();
    })

    const project_table = $('table#kt_project_table').DataTable();
    $('input[data-kt-project-table-filter=search]').on('keyup', function(e) {
        project_table.search(e.target.value).draw();
    })


    $('a.delete_member').on('click', function(e) {
        const auth_token = $("[name='csrf-token']")[0].content;
        const member_id = $(this).data('member-id');
        Swal.fire({
            text: "Are you sure you would like to delete this member?",
            icon: "warning",
            showCancelButton: true,
            buttonsStyling: false,
            confirmButtonText: "Yes, delete it!",
            cancelButtonText: "No, return",
            customClass: {
                confirmButton: "btn btn-primary",
                cancelButton: "btn btn-active-light"
            }
        }).then(function (result) {
            if (result.value) {
                $.ajax ({
                    url: '/members/' + member_id,
                    type: 'DELETE',
                    data: { authenticity_token: auth_token },
                    success: function (response) {
                        Swal.fire({
                            text: response.message,
                            icon: response.result,
                            buttonsStyling: false,
                            confirmButtonText: "Ok, got it!",
                            customClass: {
                                confirmButton: "btn btn-primary"
                            }
                        }).then(function (result) {
                            if (result.isConfirmed) {
                                window.location.reload();
                            }
                        });

                    }
                });

            } else if (result.dismiss === 'cancel') {

            }
        });
    })


    $('a.delete_team').on('click', function(e) {
        const auth_token = $("[name='csrf-token']")[0].content;
        const team_id = $(this).data('team-id');
        Swal.fire({
            text: "Are you sure you would like to delete this team?",
            icon: "warning",
            showCancelButton: true,
            buttonsStyling: false,
            confirmButtonText: "Yes, delete it!",
            cancelButtonText: "No, return",
            customClass: {
                confirmButton: "btn btn-primary",
                cancelButton: "btn btn-active-light"
            }
        }).then(function (result) {
            if (result.value) {
                $.ajax ({
                    url: '/teams/' + team_id,
                    type: 'DELETE',
                    data: { authenticity_token: auth_token },
                    success: function (response) {
                        Swal.fire({
                            text: response.message,
                            icon: response.result,
                            buttonsStyling: false,
                            confirmButtonText: "Ok, got it!",
                            customClass: {
                                confirmButton: "btn btn-primary"
                            }
                        }).then(function (result) {
                            if (result.isConfirmed) {
                                window.location.reload();
                            }
                        });

                    }
                });

            } else if (result.dismiss === 'cancel') {

            }
        });
    })


    $('a.delete_project').on('click', function(e) {
        const auth_token = $("[name='csrf-token']")[0].content;
        const project_id = $(this).data('project-id');
        Swal.fire({
            text: "Are you sure you would like to delete this project?",
            icon: "warning",
            showCancelButton: true,
            buttonsStyling: false,
            confirmButtonText: "Yes, delete it!",
            cancelButtonText: "No, return",
            customClass: {
                confirmButton: "btn btn-primary",
                cancelButton: "btn btn-active-light"
            }
        }).then(function (result) {
            if (result.value) {
                $.ajax ({
                    url: '/projects/' + project_id,
                    type: 'DELETE',
                    data: { authenticity_token: auth_token },
                    success: function (response) {
                        Swal.fire({
                            text: response.message,
                            icon: response.result,
                            buttonsStyling: false,
                            confirmButtonText: "Ok, got it!",
                            customClass: {
                                confirmButton: "btn btn-primary"
                            }
                        }).then(function (result) {
                            if (result.isConfirmed) {
                                window.location.reload();
                            }
                        });

                    }
                });

            } else if (result.dismiss === 'cancel') {

            }
        });
    })
</script>
